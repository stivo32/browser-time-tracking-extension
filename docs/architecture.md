# Browser Time Tracking Extension - Architecture

## Обзор системы

Browser Time Tracking Extension - это расширение для браузера, которое автоматически отслеживает время активности пользователя на различных сайтах и предоставляет детальную аналитику с возможностью локального хранения данных.

## Архитектурные принципы

### 1. Локальность и приватность
- Все данные хранятся локально в браузере
- Никаких внешних серверов для MVP
- Пользователь полностью контролирует свои данные

### 2. Производительность
- Минимальное влияние на производительность браузера
- Эффективное использование ресурсов
- Быстрая загрузка интерфейса (<2 секунд)

### 3. Расширяемость
- Архитектура готова к добавлению облачной синхронизации
- Модульная структура для легкого добавления функций
- API-first подход для будущих интеграций

## Компоненты системы

### 1. Browser Extension Core

#### 1.1 Background Script (`background.js`)
**Назначение**: Основная логика расширения, отслеживание активности
**Технологии**: JavaScript ES2023, Chrome Extensions API

**Функции**:
- Отслеживание переключений между вкладками
- Измерение времени активности
- Управление данными в локальном хранилище
- Периодическая очистка старых данных

**API используемые**:
- `chrome.tabs.onActivated` - отслеживание активных вкладок
- `chrome.tabs.onUpdated` - отслеживание изменений вкладок
- `chrome.storage.local` - локальное хранение данных
- `chrome.alarms` - периодические задачи

#### 1.2 Content Script (`content.js`)
**Назначение**: Сбор метаданных о страницах
**Технологии**: JavaScript ES2023

**Функции**:
- Получение заголовка страницы
- Определение типа контента
- Отслеживание изменений URL (SPA)

#### 1.3 Popup UI (`popup.html`, `popup.js`)
**Назначение**: Основной интерфейс пользователя
**Технологии**: HTML5, CSS3, JavaScript ES2023, React

**Компоненты**:
- Dashboard с общей статистикой
- Календарный вид для навигации
- Детальная статистика по доменам/страницам
- Настройки и экспорт данных

#### 1.4 Options Page (`options.html`, `options.js`)
**Назначение**: Расширенные настройки
**Технологии**: HTML5, CSS3, JavaScript ES2023

**Функции**:
- Настройки приватности
- Категоризация сайтов
- Управление данными
- Экспорт/импорт

### 2. Data Layer

#### 2.1 Data Models

**Session Model**:
```javascript
{
  date: "2024-01-15",
  domains: {
    "youtube.com": {
      totalTime: 7200, // секунды
      pages: {
        "https://youtube.com/watch?v=123": 3600,
        "https://youtube.com/feed": 3600
      },
      category: "entertainment"
    }
  }
}
```

**Domain Model**:
```javascript
{
  domain: "youtube.com",
  category: "entertainment",
  isBlocked: false,
  customName: "YouTube"
}
```

**Settings Model**:
```javascript
{
  privacy: {
    trackIncognito: false,
    dataRetentionDays: 90
  },
  categories: {
    "entertainment": ["youtube.com", "netflix.com"],
    "work": ["github.com", "stackoverflow.com"]
  }
}
```

#### 2.2 Storage Strategy

**Локальное хранилище (Chrome Storage API)**:
- `sessions` - данные по сессиям
- `domains` - настройки доменов
- `settings` - пользовательские настройки
- `metadata` - метаданные расширения

**Оптимизация**:
- Сжатие данных для экономии места
- Периодическая очистка данных старше 90 дней
- Индексация для быстрого поиска

### 3. UI Components

#### 3.1 Dashboard Component
**Функции**:
- Общая статистика за день/неделю/месяц
- Топ доменов по времени
- Графики активности

#### 3.2 Calendar Component
**Функции**:
- Навигация по дням
- Визуализация активности
- Быстрый доступ к историческим данным

#### 3.3 Domain Details Component
**Функции**:
- Детальная статистика по домену
- Список страниц с временем
- Возможность категоризации

#### 3.4 Export Component
**Функции**:
- Экспорт в CSV/JSON
- Выбор периода данных
- Настройка формата

## Технический стек

### Frontend
- **JavaScript**: ES2023 с JSDoc типизацией
- **Framework**: React 18+ с хуками
- **Build Tool**: Vite для быстрой разработки
- **Styling**: CSS3 с CSS Grid/Flexbox
- **State Management**: React Context + useReducer
- **Testing**: Jest + React Testing Library

### Development Tools
- **Linting**: ESLint с правилами для браузерных расширений
- **Formatting**: Prettier
- **Type Checking**: JSDoc + TypeScript для критических частей
- **Bundling**: Vite с поддержкой Chrome Extensions

## Безопасность и приватность

### 1. Принципы приватности
- Никаких внешних запросов без явного согласия
- Локальное хранение всех данных
- Прозрачность в сборе данных
- Возможность полного удаления данных

### 2. Безопасность данных
- Шифрование чувствительных данных в хранилище
- Валидация всех входных данных
- Защита от XSS в UI компонентах
- Безопасная обработка URL и метаданных

### 3. Разрешения расширения
- `tabs` - для отслеживания активности
- `storage` - для локального хранения
- `alarms` - для периодических задач
- `activeTab` - для получения метаданных страницы

## Производительность

### 1. Оптимизация памяти
- Ленивая загрузка исторических данных
- Сжатие данных в хранилище
- Периодическая очистка неиспользуемых данных

### 2. Оптимизация UI
- Виртуализация для больших списков
- Мемоизация компонентов
- Оптимизированные запросы к хранилищу

### 3. Мониторинг производительности
- Логирование времени выполнения операций
- Метрики использования памяти
- Отслеживание производительности UI

## Интеграции и API

### 1. Browser APIs
- Chrome Extensions API
- Web APIs для работы с данными
- Storage API для локального хранения

### 2. Будущие интеграции (Фаза 2)
- REST API для облачной синхронизации
- Webhook для уведомлений
- Export API для внешних сервисов

## Мониторинг и аналитика

### 1. Внутренняя аналитика
- Отслеживание использования функций
- Метрики производительности
- Ошибки и исключения

### 2. Пользовательская аналитика
- Время использования расширения
- Популярные функции
- Паттерны использования

## Развертывание и распространение

### 1. Chrome Web Store
- Подготовка к публикации
- Описание и скриншоты
- Политика приватности

### 2. Firefox Add-ons
- Адаптация для Firefox
- WebExtensions API
- Манифест v3

### 3. Edge Add-ons
- Совместимость с Edge
- Microsoft Store

## Будущее развитие (Фаза 2)

### 1. Облачная синхронизация
- Backend на Python + FastAPI
- Аутентификация пользователей
- Синхронизация между устройствами

### 2. Премиум функции
- Расширенная аналитика
- Уведомления и лимиты
- API для интеграций

### 3. Монетизация
- Подписочная модель
- Платежная интеграция
- B2B функции
